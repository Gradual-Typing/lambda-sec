module BigStep where

open import Data.Nat using (â„•; zero; suc; _â‰¤_) renaming (_âŠ”_ to _âŠ”â‚™_)
import Relation.Binary.PropositionalEquality as Eq
open Eq using (_â‰¡_; _â‰¢_; refl; sym; cong; congâ‚‚; subst)

open import Statics


Rename : Context â†’ Context â†’ Set
Rename Î“ Î” = âˆ€ {X} â†’ Î“ âˆ‹ X â†’ Î” âˆ‹ X

Subst : Context â†’ Context â†’ Set
Subst Î“ Î” = âˆ€ {X} â†’ Î“ âˆ‹ X â†’ Î” âŠ¢â‚‘ X

ext : âˆ€ {Î“ Î” A}
  â†’ Rename Î“ Î”
    ---------------------------------
  â†’ Rename (Î“ , A) (Î” , A)
ext Ï Z      =  Z
ext Ï (S x)  =  S (Ï x)

renameáµ¥ : âˆ€ {Î“ Î”}
  â†’ Rename Î“ Î”
    -----------------------
  â†’ (âˆ€ {A} â†’ Î“ âŠ¢áµ¥ A â†’ Î” âŠ¢áµ¥ A)
renameâ‚‘ : âˆ€ {Î“ Î”}
  â†’ Rename Î“ Î”
    -----------------------
  â†’ (âˆ€ {A} â†’ Î“ âŠ¢â‚‘ A â†’ Î” âŠ¢â‚‘ A)
renameáµ¥ Ï (Æ› N / â„“)            = Æ› (renameâ‚‘ (ext Ï) N) / â„“
renameáµ¥ Ï (`true/ â„“)           = `true/ â„“
renameáµ¥ Ï (`false/ â„“)          = `false/ â„“
renameâ‚‘ Ï (` x)                =  ` (Ï x)
renameâ‚‘ Ï (val v)              =  val (renameáµ¥ Ï v)
renameâ‚‘ Ï (L Â· M)              =  (renameâ‚‘ Ï L) Â· (renameâ‚‘ Ï M)
renameâ‚‘ Ï (if L M N)           =  if (renameâ‚‘ Ï L) (renameâ‚‘ Ï M) (renameâ‚‘ Ï N)
renameâ‚‘ Ï (M `âˆ§ N)             =  (renameâ‚‘ Ï M) `âˆ§ (renameâ‚‘ Ï N)
renameâ‚‘ Ï (M `âˆ¨ N)             =  (renameâ‚‘ Ï M) `âˆ¨ (renameâ‚‘ Ï N)
renameâ‚‘ Ï (sub M âŠ¢â‰¤)           =  sub (renameâ‚‘ Ï M) âŠ¢â‰¤

exts : âˆ€ {Î“ Î” A}
  â†’ Subst Î“ Î”
    ----------------------
  â†’ Subst (Î“ , A) (Î” , A)
exts Ïƒ Z      =  ` Z
exts Ïƒ (S x)  =  renameâ‚‘ S_ (Ïƒ x)

substáµ¥ : âˆ€ {Î“ Î”}
  â†’ Subst Î“ Î”
    ----------------------------
  â†’ (âˆ€ {A} â†’ Î“ âŠ¢áµ¥ A â†’ Î” âŠ¢áµ¥ A)
substâ‚‘ : âˆ€ {Î“ Î”}
  â†’ Subst Î“ Î”
    ----------------------------
  â†’ (âˆ€ {A} â†’ Î“ âŠ¢â‚‘ A â†’ Î” âŠ¢â‚‘ A)
substáµ¥ Ïƒ (Æ› N / â„“)          = Æ› (substâ‚‘ (exts Ïƒ) N) / â„“
substáµ¥ Ïƒ (`true/ â„“)         = `true/ â„“
substáµ¥ Ïƒ (`false/ â„“)        = `false/ â„“
substâ‚‘ Ïƒ (` k)              =  Ïƒ k
substâ‚‘ Ïƒ (val v)            =  val (substáµ¥ Ïƒ v)
substâ‚‘ Ïƒ (L Â· M)            =  (substâ‚‘ Ïƒ L) Â· (substâ‚‘ Ïƒ M)
substâ‚‘ Ïƒ (if L M N)         =  if (substâ‚‘ Ïƒ L) (substâ‚‘ Ïƒ M) (substâ‚‘ Ïƒ N)
substâ‚‘ Ïƒ (M `âˆ§ N)           =  (substâ‚‘ Ïƒ M) `âˆ§ (substâ‚‘ Ïƒ N)
substâ‚‘ Ïƒ (M `âˆ¨ N)           =  (substâ‚‘ Ïƒ M) `âˆ¨ (substâ‚‘ Ïƒ N)
substâ‚‘ Ïƒ (sub M âŠ¢â‰¤)         =  sub (substâ‚‘ Ïƒ M) âŠ¢â‰¤

_â€¢_ : âˆ€ {Î“ Î” A}
  â†’ Subst Î“ Î”
  â†’ Î” âŠ¢â‚‘ A
  â†’ Subst (Î“ , A) Î”
_â€¢_ Ïƒ M Z = M
_â€¢_ Ïƒ M (S x) = Ïƒ x

Ïƒâ‚€ : âˆ€ {Î“ A} â†’ Î“ âŠ¢â‚‘ A â†’ Subst (Î“ , A) Î“
Ïƒâ‚€ M Z      =  M
Ïƒâ‚€ M (S x)  =  ` x

_[_] : âˆ€ {Î“ A B}
  â†’ Î“ , A âŠ¢â‚‘ B
  â†’ Î“ âŠ¢â‚‘ A
    ---------
  â†’ Î“ âŠ¢â‚‘ B
_[_] {Î“} {A} {B} N M =  substâ‚‘ {Î“ , A} {Î“} (Ïƒâ‚€ M) N

subst-dist-âˆ§ : âˆ€ {Î“ Î” â„“â‚ â„“â‚‚}
  â†’ (Ïƒ : Subst Î“ Î”)
  â†’ (M : Î“ âŠ¢â‚‘ `ğ”¹ / â„“â‚)
  â†’ (N : Î“ âŠ¢â‚‘ `ğ”¹ / â„“â‚‚)
  â†’ substâ‚‘ Ïƒ (M `âˆ§ N) â‰¡ (substâ‚‘ Ïƒ M) `âˆ§ (substâ‚‘ Ïƒ N)
subst-dist-âˆ§ Ïƒ M N = refl

subst-dist-Â· : âˆ€ {Î“ Î” tâ‚ tâ‚‚ â„“â‚ â„“â‚‚ â„“}
  â†’ (Ïƒ : Subst Î“ Î”)
  â†’ (M : Î“ âŠ¢â‚‘ ((tâ‚ / â„“â‚) â‡’ (tâ‚‚ / â„“â‚‚)) / â„“)
  â†’ (N : Î“ âŠ¢â‚‘ (tâ‚ / â„“â‚))
  â†’ substâ‚‘ Ïƒ (M Â· N) â‰¡ (substâ‚‘ Ïƒ M) Â· (substâ‚‘ Ïƒ N)
subst-dist-Â· Ïƒ M N = refl


_âŸ¦âˆ§âŸ§_ : âˆ€ {â„“â‚˜ â„“â‚™}
      â†’ (M : âˆ… âŠ¢áµ¥ `ğ”¹ / â„“â‚˜)
      â†’ (N : âˆ… âŠ¢áµ¥ `ğ”¹ / â„“â‚™)
        -----------------------
      â†’ âˆ… âŠ¢áµ¥ `ğ”¹ / (â„“â‚˜ âŠ” â„“â‚™)
_âŸ¦âˆ§âŸ§_ {â„“â‚˜} {â„“â‚™} (`true/ â„“â‚˜)  (`true/ â„“â‚™)   = `true/  (â„“â‚˜ âŠ” â„“â‚™)
_âŸ¦âˆ§âŸ§_ {â„“â‚˜} {â„“â‚™} (`true/ â„“â‚˜)  (`false/ â„“â‚™)  = `false/ (â„“â‚˜ âŠ” â„“â‚™)
_âŸ¦âˆ§âŸ§_ {â„“â‚˜} {â„“â‚™} (`false/ â„“â‚˜) (`true/ â„“â‚™)   = `false/ (â„“â‚˜ âŠ” â„“â‚™)
_âŸ¦âˆ§âŸ§_ {â„“â‚˜} {â„“â‚™} (`false/ â„“â‚˜) (`false/ â„“â‚™)  = `false/ (â„“â‚˜ âŠ” â„“â‚™)

_âŸ¦âˆ¨âŸ§_ : âˆ€ {â„“â‚˜ â„“â‚™}
      â†’ (M : âˆ… âŠ¢áµ¥ `ğ”¹ / â„“â‚˜)
      â†’ (N : âˆ… âŠ¢áµ¥ `ğ”¹ / â„“â‚™)
        -----------------------
      â†’ âˆ… âŠ¢áµ¥ `ğ”¹ / (â„“â‚˜ âŠ” â„“â‚™)
_âŸ¦âˆ¨âŸ§_ {â„“â‚˜} {â„“â‚™} (`true/ â„“â‚˜)  (`true/ â„“â‚™)   = `true/  (â„“â‚˜ âŠ” â„“â‚™)
_âŸ¦âˆ¨âŸ§_ {â„“â‚˜} {â„“â‚™} (`true/ â„“â‚˜)  (`false/ â„“â‚™)  = `true/  (â„“â‚˜ âŠ” â„“â‚™)
_âŸ¦âˆ¨âŸ§_ {â„“â‚˜} {â„“â‚™} (`false/ â„“â‚˜) (`true/ â„“â‚™)   = `true/  (â„“â‚˜ âŠ” â„“â‚™)
_âŸ¦âˆ¨âŸ§_ {â„“â‚˜} {â„“â‚™} (`false/ â„“â‚˜) (`false/ â„“â‚™)  = `false/ (â„“â‚˜ âŠ” â„“â‚™)


data _â‡“_ : âˆ€ {A} â†’ âˆ… âŠ¢â‚‘ A â†’ âˆ… âŠ¢áµ¥ A â†’ Set where -- only run on closed terms

  â‡“-val : âˆ€ {A} {v : âˆ… âŠ¢áµ¥ A}
        ---------------
        â†’ (val v) â‡“ v

  â‡“-âˆ§ : âˆ€ {â„“â‚˜ â„“â‚™ Vâ‚˜ Vâ‚™} {M : âˆ… âŠ¢â‚‘ `ğ”¹ / â„“â‚˜} {N : âˆ… âŠ¢â‚‘ `ğ”¹ / â„“â‚™}
      â†’ M â‡“ Vâ‚˜
      â†’ N â‡“ Vâ‚™
        ------------------------
      â†’ (M `âˆ§ N) â‡“ (Vâ‚˜ âŸ¦âˆ§âŸ§ Vâ‚™)

  â‡“-âˆ¨ : âˆ€ {â„“â‚˜ â„“â‚™ Vâ‚˜ Vâ‚™} {M : âˆ… âŠ¢â‚‘ `ğ”¹ / â„“â‚˜} {N : âˆ… âŠ¢â‚‘ `ğ”¹ / â„“â‚™}
      â†’ M â‡“ Vâ‚˜
      â†’ N â‡“ Vâ‚™
        ------------------------
      â†’ (M `âˆ¨ N) â‡“ (Vâ‚˜ âŸ¦âˆ¨âŸ§ Vâ‚™)

  â‡“-condâ‚ : âˆ€ {t â„“â‚— â„“ Vâ‚˜} {L : âˆ… âŠ¢â‚‘ `ğ”¹ / â„“â‚—} {M : âˆ… âŠ¢â‚‘ t / (â„“ âŠ” â„“â‚—)} {N : âˆ… âŠ¢â‚‘ t / (â„“ âŠ” â„“â‚—)}
      â†’ L â‡“ (`true/ â„“â‚—)
      â†’ M â‡“ Vâ‚˜
        ------------------------
      â†’ if L M N â‡“ Vâ‚˜  {- Note `Vâ‚˜` inhabits `A âŠ”â‚› â„“â‚—` -}

  â‡“-condâ‚‚ : âˆ€ {t â„“â‚— â„“ Vâ‚™} {L : âˆ… âŠ¢â‚‘ `ğ”¹ / â„“â‚—} {M : âˆ… âŠ¢â‚‘ t / (â„“ âŠ” â„“â‚—)} {N : âˆ… âŠ¢â‚‘ t / (â„“ âŠ” â„“â‚—)}
      â†’ L â‡“ (`false/ â„“â‚—)
      â†’ N â‡“ Vâ‚™
        ------------------------
      â†’ if L M N â‡“ Vâ‚™  {- Note `Vâ‚™` inhabits `A âŠ”â‚› â„“â‚—` -}

  â‡“-app : âˆ€ {tâ‚ tâ‚‚ â„“â‚ â„“â‚‚ â„“ Vâ‚™ V Mâ€²} {M : âˆ… âŠ¢â‚‘ ((tâ‚ / â„“â‚) â‡’ (tâ‚‚ / â„“â‚‚)) / â„“} {N : âˆ… âŠ¢â‚‘ tâ‚ / â„“â‚}
      â†’ M â‡“ (Æ› Mâ€² / â„“)
      â†’ N â‡“ Vâ‚™
      â†’ (Mâ€² [ (val Vâ‚™) ]) â‡“ V
        ------------------------
      â†’ (M Â· N) â‡“ (V âŠ”áµ¥ â„“)
