module Statics where

open import Data.List using (List; []; _âˆ·_)
open import Data.Maybe
import Relation.Binary.PropositionalEquality as Eq
open Eq using (_â‰¡_; refl; sym; cong; congâ‚‚)
open import Machine




infix 4 _[_]âŠ¢_â¦‚_  -- Î“ [ pc ]âŠ¢ M â¦‚ s

data _[_]âŠ¢_â¦‚_ : Context â†’ â„’ â†’ Term â†’ ğ•Š â†’ Set where

  -- VAR:
  âŠ¢` : âˆ€ {Î“ x t ğ“ pc}
    â†’ nth Î“ x â‰¡ just (t / ğ“)
    â†’ pc âŠ‘ ğ“  -- introduces pc
      ------------------
    â†’ Î“ [ pc ]âŠ¢ ` x â¦‚ (t / ğ“)

  -- FUN:
  âŠ¢Æ› : âˆ€ {Î“ N sâ‚ sâ‚‚ ğ“ pc pcâ€²}
    â†’ (sâ‚ âˆ· ([ pc ] sâ‚ â‡’ sâ‚‚) / ğ“ âˆ· Î“) [ pc ]âŠ¢ N â¦‚ sâ‚‚
    â†’ pcâ€² âŠ‘ ğ“
      ------------------------------------------
    â†’ Î“ [ pcâ€² ]âŠ¢ Æ›[ pc ] N `/ ğ“ â¦‚ ([ pc ] sâ‚ â‡’ sâ‚‚) / ğ“

  -- TRUE:
  âŠ¢true : âˆ€ {Î“ ğ“ pc}
    â†’ pc âŠ‘ ğ“
      -------------------------
    â†’ Î“ [ pc ]âŠ¢ `true `/ ğ“ â¦‚ `ğ”¹ / ğ“

  -- FALSE:
  âŠ¢false : âˆ€ {Î“ ğ“ pc}
    â†’ pc âŠ‘ ğ“
      -------------------------
    â†’ Î“ [ pc ]âŠ¢ `false `/ ğ“ â¦‚ `ğ”¹ / ğ“

  -- UNIT:
  âŠ¢unit : âˆ€ {Î“ ğ“ pc}
    â†’ pc âŠ‘ ğ“
      -------------------------
    â†’ Î“ [ pc ]âŠ¢ `âŸ¨âŸ© `/ ğ“ â¦‚ `âŠ¤ / ğ“

  -- LOC:
  âŠ¢mem : âˆ€ {Î“ n s ğ“ pc}
    â†’ pc âŠ‘ ğ“
      --------------------------------------
    â†’ Î“ [ pc ]âŠ¢ (mem n s) `/ ğ“ â¦‚ (s ref) / ğ“

  -- APP:
  âŠ¢Â· : âˆ€ {Î“ L M sâ‚ sâ‚‚ ğ“ pc pcâ€²}
    â†’ Î“ [ pc ]âŠ¢ L â¦‚ ([ pcâ€² ] sâ‚ â‡’ sâ‚‚) / ğ“
    â†’ Î“ [ pc ]âŠ¢ M â¦‚ sâ‚
    â†’ (pc âŠ” ğ“) âŠ‘ pcâ€²
      ------------------------------------
    â†’ Î“ [ pc ]âŠ¢ L Â· M â¦‚ sâ‚‚ âŠ”â‚› ğ“

  -- AND:
  âŠ¢âˆ§ : âˆ€ {Î“ M N ğ“ pc}
    â†’ Î“ [ pc ]âŠ¢ M â¦‚ `ğ”¹ / ğ“
    â†’ Î“ [ pc ]âŠ¢ N â¦‚ `ğ”¹ / ğ“
      ---------------------------
    â†’ Î“ [ pc ]âŠ¢ M `âˆ§ N â¦‚ `ğ”¹ / ğ“

  -- OR:
  âŠ¢âˆ¨ : âˆ€ {Î“ M N ğ“ pc}
    â†’ Î“ [ pc ]âŠ¢ M â¦‚ `ğ”¹ / ğ“
    â†’ Î“ [ pc ]âŠ¢ N â¦‚ `ğ”¹ / ğ“
      --------------------------
    â†’ Î“ [ pc ]âŠ¢ M `âˆ¨ N â¦‚ `ğ”¹ / ğ“

  -- REF:
  âŠ¢ref : âˆ€ {Î“ M s pc}
    â†’ Î“ [ pc ]âŠ¢ M â¦‚ s
      -------------------------------------
    â†’ Î“ [ pc ]âŠ¢ `ref[ s ] M â¦‚ (s ref) / pc

  -- DEREF:
  âŠ¢deref : âˆ€ {Î“ M s ğ“ pc}
    â†’ Î“ [ pc ]âŠ¢ M â¦‚ (s ref) / ğ“
      -------------------------
    â†’ Î“ [ pc ]âŠ¢ ! M â¦‚ s âŠ”â‚› ğ“

  -- ASSIGN:
  âŠ¢:= : âˆ€ {Î“ L M t ğ“ ğ“â€² pc}
    â†’ Î“ [ pc ]âŠ¢ L â¦‚ ((t / ğ“) ref) / ğ“â€²
    â†’ Î“ [ pc ]âŠ¢ M â¦‚ t / ğ“
    â†’ ğ“â€² âŠ‘ ğ“
      --------------------------
    â†’ Î“ [ pc ]âŠ¢ L := M â¦‚ `âŠ¤ / pc

  -- COND:
  âŠ¢if : âˆ€ {Î“ L M N s ğ“ pc}
    â†’ Î“ [ pc ]âŠ¢ L â¦‚ `ğ”¹ / ğ“
    â†’ Î“ [ pc âŠ” ğ“ ]âŠ¢ M â¦‚ s
    â†’ Î“ [ pc âŠ” ğ“ ]âŠ¢ N â¦‚ s
      ---------------------
    â†’ Î“ [ pc ]âŠ¢ if L M N â¦‚ s

  -- SUB:
  âŠ¢sub : âˆ€ {Î“ M s sâ€² pc}
    â†’ Î“ [ pc ]âŠ¢ M â¦‚ s
    â†’ s <:â‚› sâ€²
      ---------------
    â†’ Î“ [ pc ]âŠ¢ M â¦‚ sâ€²
