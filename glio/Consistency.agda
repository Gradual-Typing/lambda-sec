module Consistency where

open import Data.Product using (_Ã—_; projâ‚; projâ‚‚) renaming (_,_ to âŸ¨_,_âŸ©)

open import StaticsGLIO
open import Lemmas using (â‰¼-refl; â‰¼-antisym)
open import Iff using (_â‡”_)



-- Consistency for labels
infixl 9 _~_

data _~_ : â„’Ì‚ â†’ â„’Ì‚ â†’ Set where

  ~-Â¿-r : âˆ€ {ğ“Ì‚} â†’ ğ“Ì‚ ~ Â¿

  ~-Â¿-l : âˆ€ {ğ“Ì‚} â†’ Â¿ ~ ğ“Ì‚

  ~-l : âˆ€ {ğ“} â†’ (lÌ‚ ğ“) ~ (lÌ‚ ğ“)

-- Consistency for types
infixl 9 _âˆ¼_

data _âˆ¼_ : ğ•‹ â†’ ğ•‹ â†’ Set where

  âˆ¼-âŠ¤ : `âŠ¤ âˆ¼ `âŠ¤

  âˆ¼-ğ”¹ : `ğ”¹ âˆ¼ `ğ”¹

  âˆ¼-â„’ : `â„’ âˆ¼ `â„’

  âˆ¼-Ref : âˆ€ {ğ“Ì‚â‚ ğ“Ì‚â‚‚ Tâ‚ Tâ‚‚}
    â†’ ğ“Ì‚â‚ ~ ğ“Ì‚â‚‚
    â†’ Tâ‚ âˆ¼ Tâ‚‚
      ----------------------
    â†’ Ref ğ“Ì‚â‚ Tâ‚ âˆ¼ Ref ğ“Ì‚â‚‚ Tâ‚‚

  âˆ¼-Lab : âˆ€ {ğ“Ì‚â‚ ğ“Ì‚â‚‚ Tâ‚ Tâ‚‚}
    â†’ ğ“Ì‚â‚ ~ ğ“Ì‚â‚‚
    â†’ Tâ‚ âˆ¼ Tâ‚‚
      ----------------------
    â†’ Lab ğ“Ì‚â‚ Tâ‚ âˆ¼ Lab ğ“Ì‚â‚‚ Tâ‚‚

  âˆ¼-â‡’ : âˆ€ {ğ“Ì‚â‚ ğ“Ì‚â‚‚ ğ“Ì‚â‚â€² ğ“Ì‚â‚‚â€² Sâ‚ Sâ‚‚ Tâ‚ Tâ‚‚}
    â†’ ğ“Ì‚â‚ ~ ğ“Ì‚â‚â€²
    â†’ ğ“Ì‚â‚‚ ~ ğ“Ì‚â‚‚â€²
    â†’ Sâ‚ âˆ¼ Tâ‚
    â†’ Sâ‚‚ âˆ¼ Tâ‚‚
      ---------------------------------------------------
    â†’ (Sâ‚ [ ğ“Ì‚â‚ ]â‡’[ ğ“Ì‚â‚‚ ] Sâ‚‚) âˆ¼ (Tâ‚ [ ğ“Ì‚â‚â€² ]â‡’[ ğ“Ì‚â‚‚â€² ] Tâ‚‚)

ğ“~ğ“â€²â‡”ğ“â‰¾ğ“â€²Ã—ğ“â€²â‰¾ğ“ : âˆ€ ğ“Ì‚ ğ“Ì‚â€² â†’ (ğ“Ì‚ ~ ğ“Ì‚â€²) â‡” (ğ“Ì‚ â‰¾ ğ“Ì‚â€² Ã— ğ“Ì‚â€² â‰¾ ğ“Ì‚)
ğ“~ğ“â€²â‡”ğ“â‰¾ğ“â€²Ã—ğ“â€²â‰¾ğ“ ğ“Ì‚ ğ“Ì‚â€² = record { to = to ; from = from }
  where
  to : ğ“Ì‚ ~ ğ“Ì‚â€² â†’ ğ“Ì‚ â‰¾ ğ“Ì‚â€² Ã— ğ“Ì‚â€² â‰¾ ğ“Ì‚
  to ~-Â¿-r = âŸ¨ â‰¾-Â¿-r , â‰¾-Â¿-l âŸ©
  to ~-Â¿-l = âŸ¨ â‰¾-Â¿-l , â‰¾-Â¿-r âŸ©
  to ~-l = âŸ¨ â‰¾-l (â‰¼-refl _) , â‰¾-l (â‰¼-refl _) âŸ©

  from : ğ“Ì‚ â‰¾ ğ“Ì‚â€² Ã— ğ“Ì‚â€² â‰¾ ğ“Ì‚ â†’ ğ“Ì‚ ~ ğ“Ì‚â€²
  from âŸ¨ â‰¾-Â¿-r , _ âŸ© = ~-Â¿-r
  from âŸ¨ â‰¾-Â¿-l , _ âŸ© = ~-Â¿-l
  from âŸ¨ â‰¾-l ğ“â‰¼ğ“â€² , â‰¾-l ğ“â€²â‰¼ğ“ âŸ© rewrite â‰¼-antisym ğ“â‰¼ğ“â€² ğ“â€²â‰¼ğ“ = ~-l
