module Consistency where

open import Data.Product using (_Ã—_; âˆƒ; âˆƒ-syntax; Î£; Î£-syntax; projâ‚; projâ‚‚) renaming (_,_ to âŸ¨_,_âŸ©)
import Relation.Binary.PropositionalEquality as Eq
open Eq using (_â‰¡_; _â‰¢_; refl; sym)
open import Data.Maybe using (Maybe; just; nothing)
open import Relation.Nullary using (Dec; yes; no; Â¬_)
open import Data.Empty using (âŠ¥; âŠ¥-elim)

open import StaticsGLIO
open import Lemmas using (â‰¼-refl; â‰¼-antisym)
open import Iff using (_â‡”_)



-- Consistency for labels
infixl 9 _~_

data _~_ : â„’Ì‚ â†’ â„’Ì‚ â†’ Set where

  ~-Â¿-r : âˆ€ {â„“Ì‚} â†’ â„“Ì‚ ~ Â¿

  ~-Â¿-l : âˆ€ {â„“Ì‚} â†’ Â¿ ~ â„“Ì‚

  ~-l : âˆ€ {â„“} â†’ (lÌ‚ â„“) ~ (lÌ‚ â„“)

-- Consistency for types
infixl 9 _âˆ¼_

data _âˆ¼_ : ğ•‹ â†’ ğ•‹ â†’ Set where

  âˆ¼-âŠ¤ : `âŠ¤ âˆ¼ `âŠ¤

  âˆ¼-ğ”¹ : `ğ”¹ âˆ¼ `ğ”¹

  âˆ¼-â„’ : `â„’ âˆ¼ `â„’

  âˆ¼-Ref : âˆ€ {â„“Ì‚â‚ â„“Ì‚â‚‚ Tâ‚ Tâ‚‚}
    â†’ â„“Ì‚â‚ ~ â„“Ì‚â‚‚
    â†’ Tâ‚ âˆ¼ Tâ‚‚
      ----------------------
    â†’ Ref â„“Ì‚â‚ Tâ‚ âˆ¼ Ref â„“Ì‚â‚‚ Tâ‚‚

  âˆ¼-Lab : âˆ€ {â„“Ì‚â‚ â„“Ì‚â‚‚ Tâ‚ Tâ‚‚}
    â†’ â„“Ì‚â‚ ~ â„“Ì‚â‚‚
    â†’ Tâ‚ âˆ¼ Tâ‚‚
      ----------------------
    â†’ Lab â„“Ì‚â‚ Tâ‚ âˆ¼ Lab â„“Ì‚â‚‚ Tâ‚‚

  âˆ¼-â‡’ : âˆ€ {â„“Ì‚â‚ â„“Ì‚â‚‚ â„“Ì‚â‚â€² â„“Ì‚â‚‚â€² Sâ‚ Sâ‚‚ Tâ‚ Tâ‚‚}
    â†’ â„“Ì‚â‚ ~ â„“Ì‚â‚â€²
    â†’ â„“Ì‚â‚‚ ~ â„“Ì‚â‚‚â€²
    â†’ Sâ‚ âˆ¼ Tâ‚
    â†’ Sâ‚‚ âˆ¼ Tâ‚‚
      ---------------------------------------------------
    â†’ (Sâ‚ [ â„“Ì‚â‚ ]â‡’[ â„“Ì‚â‚‚ ] Sâ‚‚) âˆ¼ (Tâ‚ [ â„“Ì‚â‚â€² ]â‡’[ â„“Ì‚â‚‚â€² ] Tâ‚‚)

â„“~â„“â€²â‡”â„“â‰¾â„“â€²Ã—â„“â€²â‰¾â„“ : âˆ€ â„“Ì‚ â„“Ì‚â€² â†’ (â„“Ì‚ ~ â„“Ì‚â€²) â‡” (â„“Ì‚ â‰¾ â„“Ì‚â€² Ã— â„“Ì‚â€² â‰¾ â„“Ì‚)
â„“~â„“â€²â‡”â„“â‰¾â„“â€²Ã—â„“â€²â‰¾â„“ â„“Ì‚ â„“Ì‚â€² = record { to = to ; from = from }
  where
  to : â„“Ì‚ ~ â„“Ì‚â€² â†’ â„“Ì‚ â‰¾ â„“Ì‚â€² Ã— â„“Ì‚â€² â‰¾ â„“Ì‚
  to ~-Â¿-r = âŸ¨ â‰¾-Â¿-r , â‰¾-Â¿-l âŸ©
  to ~-Â¿-l = âŸ¨ â‰¾-Â¿-l , â‰¾-Â¿-r âŸ©
  to ~-l = âŸ¨ â‰¾-l (â‰¼-refl _) , â‰¾-l (â‰¼-refl _) âŸ©

  from : â„“Ì‚ â‰¾ â„“Ì‚â€² Ã— â„“Ì‚â€² â‰¾ â„“Ì‚ â†’ â„“Ì‚ ~ â„“Ì‚â€²
  from âŸ¨ â‰¾-Â¿-r , _ âŸ© = ~-Â¿-r
  from âŸ¨ â‰¾-Â¿-l , _ âŸ© = ~-Â¿-l
  from âŸ¨ â‰¾-l â„“â‰¼â„“â€² , â‰¾-l â„“â€²â‰¼â„“ âŸ© rewrite â‰¼-antisym â„“â‰¼â„“â€² â„“â€²â‰¼â„“ = ~-l

Sâˆ¼Tâ‡”Sâ‰²TÃ—Tâ‰²S : âˆ€ S T â†’ (S âˆ¼ T) â‡” (S â‰² T Ã— T â‰² S)
Sâˆ¼Tâ‡”Sâ‰²TÃ—Tâ‰²S S T = record { to = to ; from = from }
  where
  to : S âˆ¼ T â†’ S â‰² T Ã— T â‰² S
  to âˆ¼-âŠ¤ = âŸ¨ â‰²-âŠ¤ , â‰²-âŠ¤ âŸ©
  to âˆ¼-ğ”¹ = âŸ¨ â‰²-ğ”¹ , â‰²-ğ”¹ âŸ©
  to âˆ¼-â„’ = âŸ¨ â‰²-â„’ , â‰²-â„’ âŸ©
  to (âˆ¼-Ref â„“â‚~â„“â‚‚ Sâˆ¼T) =
    let âŸ¨ â„“â‚â‰¾â„“â‚‚ , â„“â‚‚â‰¾â„“â‚ âŸ© = _â‡”_.to (â„“~â„“â€²â‡”â„“â‰¾â„“â€²Ã—â„“â€²â‰¾â„“ _ _) â„“â‚~â„“â‚‚ in
    let âŸ¨ Tâ‚â‰²Tâ‚‚ , Tâ‚‚â‰²Tâ‚ âŸ© = _â‡”_.to (Sâˆ¼Tâ‡”Sâ‰²TÃ—Tâ‰²S _ _) Sâˆ¼T in
      âŸ¨ â‰²-Ref â„“â‚â‰¾â„“â‚‚ â„“â‚‚â‰¾â„“â‚ Tâ‚â‰²Tâ‚‚ Tâ‚‚â‰²Tâ‚ , â‰²-Ref â„“â‚‚â‰¾â„“â‚ â„“â‚â‰¾â„“â‚‚ Tâ‚‚â‰²Tâ‚ Tâ‚â‰²Tâ‚‚ âŸ©
  to (âˆ¼-Lab â„“â‚~â„“â‚‚ Sâˆ¼T) =
    let âŸ¨ â„“â‚â‰¾â„“â‚‚ , â„“â‚‚â‰¾â„“â‚ âŸ© = _â‡”_.to (â„“~â„“â€²â‡”â„“â‰¾â„“â€²Ã—â„“â€²â‰¾â„“ _ _) â„“â‚~â„“â‚‚ in
    let âŸ¨ Tâ‚â‰²Tâ‚‚ , Tâ‚‚â‰²Tâ‚ âŸ© = _â‡”_.to (Sâˆ¼Tâ‡”Sâ‰²TÃ—Tâ‰²S _ _) Sâˆ¼T in
      âŸ¨ â‰²-Lab â„“â‚â‰¾â„“â‚‚ Tâ‚â‰²Tâ‚‚ , â‰²-Lab â„“â‚‚â‰¾â„“â‚ Tâ‚‚â‰²Tâ‚ âŸ©
  to (âˆ¼-â‡’ â„“â‚~â„“â‚â€² â„“â‚‚~â„“â‚‚â€² Sâ‚âˆ¼Tâ‚ Sâ‚‚âˆ¼Tâ‚‚) =
    let âŸ¨ â„“â‚â‰¾â„“â‚â€² , â„“â‚â€²â‰¾â„“â‚ âŸ© = _â‡”_.to (â„“~â„“â€²â‡”â„“â‰¾â„“â€²Ã—â„“â€²â‰¾â„“ _ _) â„“â‚~â„“â‚â€² in
    let âŸ¨ â„“â‚‚â‰¾â„“â‚‚â€² , â„“â‚‚â€²â‰¾â„“â‚‚ âŸ© = _â‡”_.to (â„“~â„“â€²â‡”â„“â‰¾â„“â€²Ã—â„“â€²â‰¾â„“ _ _) â„“â‚‚~â„“â‚‚â€² in
    let âŸ¨ Sâ‚â‰²Tâ‚ , Tâ‚â‰²Sâ‚ âŸ© = _â‡”_.to (Sâˆ¼Tâ‡”Sâ‰²TÃ—Tâ‰²S _ _) Sâ‚âˆ¼Tâ‚ in
    let âŸ¨ Sâ‚‚â‰²Tâ‚‚ , Tâ‚‚â‰²Sâ‚‚ âŸ© = _â‡”_.to (Sâˆ¼Tâ‡”Sâ‰²TÃ—Tâ‰²S _ _) Sâ‚‚âˆ¼Tâ‚‚ in
      âŸ¨ â‰²-â‡’ â„“â‚â€²â‰¾â„“â‚ â„“â‚‚â‰¾â„“â‚‚â€² Tâ‚â‰²Sâ‚ Sâ‚‚â‰²Tâ‚‚ , â‰²-â‡’ â„“â‚â‰¾â„“â‚â€² â„“â‚‚â€²â‰¾â„“â‚‚ Sâ‚â‰²Tâ‚ Tâ‚‚â‰²Sâ‚‚ âŸ©

  from : S â‰² T Ã— T â‰² S â†’ S âˆ¼ T
  from âŸ¨ â‰²-âŠ¤ , â‰²-âŠ¤ âŸ© = âˆ¼-âŠ¤
  from âŸ¨ â‰²-ğ”¹ , â‰²-ğ”¹ âŸ© = âˆ¼-ğ”¹
  from âŸ¨ â‰²-â„’ , â‰²-â„’ âŸ© = âˆ¼-â„’
  from âŸ¨ â‰²-Ref â„“â‚â‰¾â„“â‚‚ â„“â‚‚â‰¾â„“â‚ Tâ‚â‰²Tâ‚‚ Tâ‚‚â‰²Tâ‚ , â‰²-Ref _ _ _ _ âŸ© =
    let â„“â‚~â„“â‚‚ = _â‡”_.from (â„“~â„“â€²â‡”â„“â‰¾â„“â€²Ã—â„“â€²â‰¾â„“ _ _) âŸ¨ â„“â‚â‰¾â„“â‚‚ , â„“â‚‚â‰¾â„“â‚ âŸ© in
    let Tâ‚âˆ¼Tâ‚‚ = _â‡”_.from (Sâˆ¼Tâ‡”Sâ‰²TÃ—Tâ‰²S _ _) âŸ¨ Tâ‚â‰²Tâ‚‚ , Tâ‚‚â‰²Tâ‚ âŸ© in
      âˆ¼-Ref â„“â‚~â„“â‚‚ Tâ‚âˆ¼Tâ‚‚
  from âŸ¨ â‰²-Lab â„“â‚â‰¾â„“â‚‚ Tâ‚â‰²Tâ‚‚ , â‰²-Lab â„“â‚‚â‰¾â„“â‚ Tâ‚‚â‰²Tâ‚ âŸ© =
    let â„“â‚~â„“â‚‚ = _â‡”_.from (â„“~â„“â€²â‡”â„“â‰¾â„“â€²Ã—â„“â€²â‰¾â„“ _ _) âŸ¨ â„“â‚â‰¾â„“â‚‚ , â„“â‚‚â‰¾â„“â‚ âŸ© in
    let Tâ‚âˆ¼Tâ‚‚ = _â‡”_.from (Sâˆ¼Tâ‡”Sâ‰²TÃ—Tâ‰²S _ _) âŸ¨ Tâ‚â‰²Tâ‚‚ , Tâ‚‚â‰²Tâ‚ âŸ© in
      âˆ¼-Lab â„“â‚~â„“â‚‚ Tâ‚âˆ¼Tâ‚‚
  from âŸ¨ â‰²-â‡’ â„“â‚â€²â‰¾â„“â‚ â„“â‚‚â‰¾â„“â‚‚â€² Tâ‚â€²â‰²Tâ‚ Tâ‚‚â‰²Tâ‚‚â€² , â‰²-â‡’ â„“â‚â‰¾â„“â‚â€² â„“â‚‚â€²â‰¾â„“â‚‚ Tâ‚â‰²Tâ‚â€² Tâ‚‚â€²â‰²Tâ‚‚ âŸ© =
    let â„“â‚~â„“â‚â€² = _â‡”_.from (â„“~â„“â€²â‡”â„“â‰¾â„“â€²Ã—â„“â€²â‰¾â„“ _ _) âŸ¨ â„“â‚â‰¾â„“â‚â€² , â„“â‚â€²â‰¾â„“â‚ âŸ© in
    let â„“â‚‚~â„“â‚‚â€² = _â‡”_.from (â„“~â„“â€²â‡”â„“â‰¾â„“â€²Ã—â„“â€²â‰¾â„“ _ _) âŸ¨ â„“â‚‚â‰¾â„“â‚‚â€² , â„“â‚‚â€²â‰¾â„“â‚‚ âŸ© in
    let Tâ‚âˆ¼Tâ‚â€² = _â‡”_.from (Sâˆ¼Tâ‡”Sâ‰²TÃ—Tâ‰²S _ _) âŸ¨ Tâ‚â‰²Tâ‚â€² , Tâ‚â€²â‰²Tâ‚ âŸ© in
    let Tâ‚‚âˆ¼Tâ‚‚â€² = _â‡”_.from (Sâˆ¼Tâ‡”Sâ‰²TÃ—Tâ‰²S _ _) âŸ¨ Tâ‚‚â‰²Tâ‚‚â€² , Tâ‚‚â€²â‰²Tâ‚‚ âŸ© in
      âˆ¼-â‡’ â„“â‚~â„“â‚â€² â„“â‚‚~â„“â‚‚â€² Tâ‚âˆ¼Tâ‚â€² Tâ‚‚âˆ¼Tâ‚‚â€²

-- Recall that label and type intersections are partial functions.
private
  ~â†’âˆ : âˆ€ {â„“Ì‚â‚ â„“Ì‚â‚‚} â†’ â„“Ì‚â‚ ~ â„“Ì‚â‚‚ â†’ âˆƒ[ â„“Ì‚ ] (â„“Ì‚â‚ âˆ â„“Ì‚â‚‚ â‰¡ just â„“Ì‚)
  ~â†’âˆ {Â¿} ~-Â¿-r = âŸ¨ Â¿ , refl âŸ©
  ~â†’âˆ {lÌ‚ â„“} ~-Â¿-r = âŸ¨ lÌ‚ â„“ , refl âŸ©
  ~â†’âˆ {â„“Ì‚â‚‚ = Â¿} ~-Â¿-l = âŸ¨ Â¿ , refl âŸ©
  ~â†’âˆ {â„“Ì‚â‚‚ = lÌ‚ â„“} ~-Â¿-l = âŸ¨ lÌ‚ â„“ , refl âŸ©
  ~â†’âˆ {lÌ‚ â„“} ~-l with â„“ â‰Ÿ â„“
  ... | yes _ = âŸ¨ lÌ‚ â„“ , refl âŸ©
  ... | no â„“â‰¢â„“ = âŠ¥-elim (â„“â‰¢â„“ refl)

  âˆ¼â†’âˆ© : âˆ€ {Tâ‚ Tâ‚‚} â†’ Tâ‚ âˆ¼ Tâ‚‚ â†’ âˆƒ[ S ] (Tâ‚ âˆ© Tâ‚‚ â‰¡ just S)
  âˆ¼â†’âˆ© âˆ¼-âŠ¤ = âŸ¨ `âŠ¤ , refl âŸ©
  âˆ¼â†’âˆ© âˆ¼-ğ”¹ = âŸ¨ `ğ”¹ , refl âŸ©
  âˆ¼â†’âˆ© âˆ¼-â„’ = âŸ¨ `â„’ , refl âŸ©
  âˆ¼â†’âˆ© (âˆ¼-Ref â„“â‚~â„“â‚‚ Tâ‚âˆ¼Tâ‚‚) with ~â†’âˆ â„“â‚~â„“â‚‚ | âˆ¼â†’âˆ© Tâ‚âˆ¼Tâ‚‚
  ... | âŸ¨ â„“Ì‚ , eqâ‚ âŸ© | âŸ¨ T , eqâ‚‚ âŸ© rewrite eqâ‚ | eqâ‚‚ = âŸ¨ Ref â„“Ì‚ T , refl âŸ©
  âˆ¼â†’âˆ© (âˆ¼-Lab â„“â‚~â„“â‚‚ Tâ‚âˆ¼Tâ‚‚) with ~â†’âˆ â„“â‚~â„“â‚‚ | âˆ¼â†’âˆ© Tâ‚âˆ¼Tâ‚‚
  ... | âŸ¨ â„“Ì‚ , eqâ‚ âŸ© | âŸ¨ T , eqâ‚‚ âŸ© rewrite eqâ‚ | eqâ‚‚ = âŸ¨ Lab â„“Ì‚ T , refl âŸ©
  âˆ¼â†’âˆ© (âˆ¼-â‡’ â„“â‚~â„“â‚â€² â„“â‚‚~â„“â‚‚â€² Sâ‚âˆ¼Tâ‚ Sâ‚‚âˆ¼Tâ‚‚) with ~â†’âˆ â„“â‚~â„“â‚â€² | ~â†’âˆ â„“â‚‚~â„“â‚‚â€² | âˆ¼â†’âˆ© Sâ‚âˆ¼Tâ‚ | âˆ¼â†’âˆ© Sâ‚‚âˆ¼Tâ‚‚
  ... | âŸ¨ â„“Ì‚â‚â€³ , eqâ‚ âŸ© | âŸ¨ â„“Ì‚â‚‚â€³ , eqâ‚‚ âŸ© | âŸ¨ Tâ‚â€³ , eqâ‚ƒ âŸ© | âŸ¨ Tâ‚‚â€³ , eqâ‚„ âŸ© rewrite eqâ‚ | eqâ‚‚ | eqâ‚ƒ | eqâ‚„ = âŸ¨ Tâ‚â€³ [ â„“Ì‚â‚â€³ ]â‡’[ â„“Ì‚â‚‚â€³ ] Tâ‚‚â€³ , refl âŸ©

  âˆ¼â†’âˆ¨ : âˆ€ {Tâ‚ Tâ‚‚} â†’ Tâ‚ âˆ¼ Tâ‚‚ â†’ âˆƒ[ S ] (Tâ‚ âˆ¨ Tâ‚‚ â‰¡ just S)
  âˆ¼â†’âˆ§ : âˆ€ {Tâ‚ Tâ‚‚} â†’ Tâ‚ âˆ¼ Tâ‚‚ â†’ âˆƒ[ S ] (Tâ‚ âˆ§ Tâ‚‚ â‰¡ just S)

  âˆ¼â†’âˆ¨ âˆ¼-âŠ¤ = âŸ¨ `âŠ¤ , refl âŸ©
  âˆ¼â†’âˆ¨ âˆ¼-ğ”¹ = âŸ¨ `ğ”¹ , refl âŸ©
  âˆ¼â†’âˆ¨ âˆ¼-â„’ = âŸ¨ `â„’ , refl âŸ©
  âˆ¼â†’âˆ¨ (âˆ¼-Ref â„“â‚~â„“â‚‚ Tâ‚âˆ¼Tâ‚‚) with ~â†’âˆ â„“â‚~â„“â‚‚ | âˆ¼â†’âˆ© Tâ‚âˆ¼Tâ‚‚
  ... | âŸ¨ â„“Ì‚ , eqâ‚ âŸ© | âŸ¨ T , eqâ‚‚ âŸ© rewrite eqâ‚ | eqâ‚‚ = âŸ¨ Ref â„“Ì‚ T , refl âŸ©
  âˆ¼â†’âˆ¨ (âˆ¼-Lab â„“â‚~â„“â‚‚ Tâ‚âˆ¼Tâ‚‚) with âˆ¼â†’âˆ¨ Tâ‚âˆ¼Tâ‚‚
  ... | âŸ¨ T , eq âŸ© rewrite eq = âŸ¨ Lab _ T , refl âŸ©
  âˆ¼â†’âˆ¨ (âˆ¼-â‡’ â„“â‚~â„“â‚â€² â„“â‚‚~â„“â‚‚â€² Sâ‚âˆ¼Tâ‚ Sâ‚‚âˆ¼Tâ‚‚) with âˆ¼â†’âˆ§ Sâ‚âˆ¼Tâ‚ | âˆ¼â†’âˆ¨ Sâ‚‚âˆ¼Tâ‚‚
  ... | âŸ¨ Tâ‚â€³ , eqâ‚ âŸ© | âŸ¨ Tâ‚‚â€³ , eqâ‚‚ âŸ© rewrite eqâ‚ | eqâ‚‚ = âŸ¨ Tâ‚â€³ [ _ ]â‡’[ _ ] Tâ‚‚â€³ , refl âŸ©

  âˆ¼â†’âˆ§ âˆ¼-âŠ¤ = âŸ¨ `âŠ¤ , refl âŸ©
  âˆ¼â†’âˆ§ âˆ¼-ğ”¹ = âŸ¨ `ğ”¹ , refl âŸ©
  âˆ¼â†’âˆ§ âˆ¼-â„’ = âŸ¨ `â„’ , refl âŸ©
  âˆ¼â†’âˆ§ (âˆ¼-Ref â„“â‚~â„“â‚‚ Tâ‚âˆ¼Tâ‚‚) with ~â†’âˆ â„“â‚~â„“â‚‚ | âˆ¼â†’âˆ© Tâ‚âˆ¼Tâ‚‚
  ... | âŸ¨ â„“Ì‚ , eqâ‚ âŸ© | âŸ¨ T , eqâ‚‚ âŸ© rewrite eqâ‚ | eqâ‚‚ = âŸ¨ Ref â„“Ì‚ T , refl âŸ©
  âˆ¼â†’âˆ§ (âˆ¼-Lab â„“â‚~â„“â‚‚ Tâ‚âˆ¼Tâ‚‚) with âˆ¼â†’âˆ§ Tâ‚âˆ¼Tâ‚‚
  ... | âŸ¨ T , eq âŸ© rewrite eq = âŸ¨ Lab _ T , refl âŸ©
  âˆ¼â†’âˆ§ (âˆ¼-â‡’ â„“â‚~â„“â‚â€² â„“â‚‚~â„“â‚‚â€² Sâ‚âˆ¼Tâ‚ Sâ‚‚âˆ¼Tâ‚‚) with âˆ¼â†’âˆ¨ Sâ‚âˆ¼Tâ‚ | âˆ¼â†’âˆ§ Sâ‚‚âˆ¼Tâ‚‚
  ... | âŸ¨ Tâ‚â€³ , eqâ‚ âŸ© | âŸ¨ Tâ‚‚â€³ , eqâ‚‚ âŸ© rewrite eqâ‚ | eqâ‚‚ = âŸ¨ Tâ‚â€³ [ _ ]â‡’[ _ ] Tâ‚‚â€³ , refl âŸ©

âˆ~ : âˆ€ {â„“Ì‚â‚ â„“Ì‚â‚‚} â†’ â„“Ì‚â‚ ~ â„“Ì‚â‚‚ â†’ â„’Ì‚
âˆ~ â„“â‚~â„“â‚‚ = projâ‚ (~â†’âˆ â„“â‚~â„“â‚‚)

âˆ©âˆ¼ : âˆ€ {S T} â†’ S âˆ¼ T â†’ ğ•‹
âˆ©âˆ¼ Sâˆ¼T = projâ‚ (âˆ¼â†’âˆ© Sâˆ¼T)

âˆ¨âˆ¼ : âˆ€ {S T} â†’ S âˆ¼ T â†’ ğ•‹
âˆ¨âˆ¼ Sâˆ¼T = projâ‚ (âˆ¼â†’âˆ¨ Sâˆ¼T)

âˆ§âˆ¼ : âˆ€ {S T} â†’ S âˆ¼ T â†’ ğ•‹
âˆ§âˆ¼ Sâˆ¼T = projâ‚ (âˆ¼â†’âˆ§ Sâˆ¼T)

private
  -- Tests:
  _ : âˆƒ[ x ] (âˆ~ (~-l {l 42}) â‰¡ x)
  _ = âŸ¨ lÌ‚ (l 42) , refl âŸ©

  _ : âˆƒ[ T ] (âˆ©âˆ¼ (âˆ¼-Lab (~-Â¿-r {lÌ‚ (l 42)}) âˆ¼-âŠ¤) â‰¡ T)
  _ = âŸ¨ Lab (lÌ‚ (l 42)) `âŠ¤ , refl âŸ©
