open import Data.Nat using (â„•; zero; suc; _â‰¤_; zâ‰¤n; sâ‰¤s) renaming (_âŠ”_ to _âŠ”â‚™_; _âŠ“_ to _âŠ“â‚™_; _â‰Ÿ_ to _â‰Ÿâ‚™_)
open import Data.Nat.Properties using (mâ‰¤mâŠ”n; mâ‰¤nâ‡’mâ‰¤nâŠ”o)
import Relation.Binary.PropositionalEquality as Eq
open Eq using (_â‰¡_; refl)

open import StaticsGLIO
import Syntax
open Syntax.OpSig Op sig
  using (`_; _â¦…_â¦†; cons; nil; bind; ast; _[_]; Subst; âŸª_âŸ«; âŸ¦_âŸ§; exts; rename)
  renaming (ABT to Term)



infixl 9 _â‰º:_

data _â‰º:_ : â„’Ì‚ â†’ â„’Ì‚ â†’ Set where

  â‰º:-Â¿ : âˆ€ {ğ“Ì‚} â†’ ğ“Ì‚ â‰º: Â¿

  â‰º-l : âˆ€ {ğ“â‚ ğ“â‚‚}
    â†’ ğ“â‚ â‰¼ ğ“â‚‚
    â†’ (lÌ‚ ğ“â‚) â‰º: (lÌ‚ ğ“â‚‚)

ğ“â‹Â¿â‰¡Â¿ : âˆ€ ğ“Ì‚ â†’ ğ“Ì‚ â‹ Â¿ â‰¡ Â¿
ğ“â‹Â¿â‰¡Â¿ Â¿ = refl
ğ“â‹Â¿â‰¡Â¿ (lÌ‚ _) = refl

ğ“â‰¼ğ“â‚â†’ğ“â‰¼ğ“â‚âŠ”ğ“â‚‚ : âˆ€ {ğ“ ğ“â‚}
  â†’ (ğ“â‚‚ : â„’)
  â†’ ğ“ â‰¼ ğ“â‚
  â†’ ğ“ â‰¼ ğ“â‚ âŠ” ğ“â‚‚
ğ“â‰¼ğ“â‚â†’ğ“â‰¼ğ“â‚âŠ”ğ“â‚‚ {l n} {l nâ‚} (l nâ‚‚) (â‰¼-l nâ‰¤nâ‚) = â‰¼-l (mâ‰¤nâ‡’mâ‰¤nâŠ”o nâ‚‚ nâ‰¤nâ‚)

ğ“â‰¾ğ“â‚â†’ğ“â‰º:ğ“â‚â‹ğ“â‚‚ : âˆ€ {ğ“ ğ“Ì‚â‚}
  â†’ (ğ“Ì‚â‚‚ : â„’Ì‚)
  â†’ (lÌ‚ ğ“) â‰¾ ğ“Ì‚â‚
  â†’ (lÌ‚ ğ“) â‰º: ğ“Ì‚â‚ â‹ ğ“Ì‚â‚‚
ğ“â‰¾ğ“â‚â†’ğ“â‰º:ğ“â‚â‹ğ“â‚‚ {ğ“} {ğ“Ì‚â‚} Â¿ ğ“â‰¾ğ“â‚ rewrite ğ“â‹Â¿â‰¡Â¿ ğ“Ì‚â‚ = â‰º:-Â¿
ğ“â‰¾ğ“â‚â†’ğ“â‰º:ğ“â‚â‹ğ“â‚‚ {ğ“} {Â¿} (lÌ‚ _) _ = â‰º:-Â¿
ğ“â‰¾ğ“â‚â†’ğ“â‰º:ğ“â‚â‹ğ“â‚‚ {ğ“} {lÌ‚ ğ“â‚} (lÌ‚ ğ“â‚‚) (â‰¾-l ğ“â‰¼ğ“â‚) = â‰º-l (ğ“â‰¼ğ“â‚â†’ğ“â‰¼ğ“â‚âŠ”ğ“â‚‚ ğ“â‚‚ ğ“â‰¼ğ“â‚)

ğ“â‰¼ğ“âŠ”ğ“â€² : âˆ€ ğ“ ğ“â€² â†’ ğ“ â‰¼ (ğ“ âŠ” ğ“â€²)
ğ“â‰¼ğ“âŠ”ğ“â€² (l n) (l nâ€²) = â‰¼-l (mâ‰¤mâŠ”n n nâ€²)

ğ“â‰º:ğ“â‹ğ“â€² : âˆ€ ğ“Ì‚ ğ“Ì‚â€² â†’ ğ“Ì‚ â‰º: ğ“Ì‚ â‹ ğ“Ì‚â€²
ğ“â‰º:ğ“â‹ğ“â€² ğ“Ì‚ Â¿ rewrite ğ“â‹Â¿â‰¡Â¿ ğ“Ì‚ = â‰º:-Â¿
ğ“â‰º:ğ“â‹ğ“â€² Â¿ (lÌ‚ ğ“â€²) = â‰º:-Â¿
ğ“â‰º:ğ“â‹ğ“â€² (lÌ‚ ğ“) (lÌ‚ ğ“â€²) = â‰º-l (ğ“â‰¼ğ“âŠ”ğ“â€² ğ“ ğ“â€²)

-- CastL ğ“Ì‚â‚ â‡› ğ“Ì‚â‚‚ never fails if ğ“Ì‚â‚ â‰º: ğ“Ì‚â‚‚
