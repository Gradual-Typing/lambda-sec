module Statics where

open import Data.List using (List; []; _âˆ·_)
open import Data.Maybe
import Relation.Binary.PropositionalEquality as Eq
open Eq using (_â‰¡_; refl; sym; cong; congâ‚‚)
open import Machine




infix 4 _[_]âŠ¢_â¦‚_  -- Î“ [ pc ]âŠ¢ M â¦‚ s

data _[_]âŠ¢_â¦‚_ : Context â†’ â„’ â†’ Term â†’ ğ•Š â†’ Set where

  -- VAR:
  âŠ¢` : âˆ€ {Î“ x t â„“ pc}
    â†’ nth Î“ x â‰¡ just (t / â„“)
    â†’ pc âŠ‘ â„“  -- introduces pc
      ------------------
    â†’ Î“ [ pc ]âŠ¢ ` x â¦‚ (t / â„“)

  -- FUN:
  âŠ¢Æ› : âˆ€ {Î“ N sâ‚ sâ‚‚ â„“ pc pcâ€²}
    â†’ (sâ‚ âˆ· ([ pc ] sâ‚ â‡’ sâ‚‚) / â„“ âˆ· Î“) [ pc ]âŠ¢ N â¦‚ sâ‚‚
    â†’ pcâ€² âŠ‘ â„“
      ------------------------------------------
    â†’ Î“ [ pcâ€² ]âŠ¢ Æ›[ pc ] N `/ â„“ â¦‚ ([ pc ] sâ‚ â‡’ sâ‚‚) / â„“

  -- TRUE:
  âŠ¢true : âˆ€ {Î“ â„“ pc}
    â†’ pc âŠ‘ â„“
      -------------------------
    â†’ Î“ [ pc ]âŠ¢ `true `/ â„“ â¦‚ `ğ”¹ / â„“

  -- FALSE:
  âŠ¢false : âˆ€ {Î“ â„“ pc}
    â†’ pc âŠ‘ â„“
      -------------------------
    â†’ Î“ [ pc ]âŠ¢ `false `/ â„“ â¦‚ `ğ”¹ / â„“

  -- UNIT:
  âŠ¢unit : âˆ€ {Î“ â„“ pc}
    â†’ pc âŠ‘ â„“
      -------------------------
    â†’ Î“ [ pc ]âŠ¢ `âŸ¨âŸ© `/ â„“ â¦‚ `âŠ¤ / â„“

  -- LOC:
  âŠ¢mem : âˆ€ {Î“ n s â„“ pc}
    â†’ pc âŠ‘ â„“
      --------------------------------------
    â†’ Î“ [ pc ]âŠ¢ (mem n s) `/ â„“ â¦‚ (s ref) / â„“

  -- APP:
  âŠ¢Â· : âˆ€ {Î“ L M sâ‚ sâ‚‚ â„“ pc pcâ€²}
    â†’ Î“ [ pc ]âŠ¢ L â¦‚ ([ pcâ€² ] sâ‚ â‡’ sâ‚‚) / â„“
    â†’ Î“ [ pc ]âŠ¢ M â¦‚ sâ‚
    â†’ (pc âŠ” â„“) âŠ‘ pcâ€²
      ------------------------------------
    â†’ Î“ [ pc ]âŠ¢ L Â· M â¦‚ sâ‚‚ âŠ”â‚› â„“

  -- AND:
  âŠ¢âˆ§ : âˆ€ {Î“ M N â„“ pc}
    â†’ Î“ [ pc ]âŠ¢ M â¦‚ `ğ”¹ / â„“
    â†’ Î“ [ pc ]âŠ¢ N â¦‚ `ğ”¹ / â„“
      ---------------------------
    â†’ Î“ [ pc ]âŠ¢ M `âˆ§ N â¦‚ `ğ”¹ / â„“

  -- OR:
  âŠ¢âˆ¨ : âˆ€ {Î“ M N â„“ pc}
    â†’ Î“ [ pc ]âŠ¢ M â¦‚ `ğ”¹ / â„“
    â†’ Î“ [ pc ]âŠ¢ N â¦‚ `ğ”¹ / â„“
      --------------------------
    â†’ Î“ [ pc ]âŠ¢ M `âˆ¨ N â¦‚ `ğ”¹ / â„“

  -- REF:
  âŠ¢ref : âˆ€ {Î“ M s pc}
    â†’ Î“ [ pc ]âŠ¢ M â¦‚ s
      -------------------------------------
    â†’ Î“ [ pc ]âŠ¢ `ref[ s ] M â¦‚ (s ref) / pc

  -- DEREF:
  âŠ¢deref : âˆ€ {Î“ M s â„“ pc}
    â†’ Î“ [ pc ]âŠ¢ M â¦‚ (s ref) / â„“
      -------------------------
    â†’ Î“ [ pc ]âŠ¢ ! M â¦‚ s âŠ”â‚› â„“

  -- ASSIGN:
  âŠ¢:= : âˆ€ {Î“ L M t â„“ â„“â€² pc}
    â†’ Î“ [ pc ]âŠ¢ L â¦‚ ((t / â„“) ref) / â„“â€²
    â†’ Î“ [ pc ]âŠ¢ M â¦‚ t / â„“
    â†’ â„“â€² âŠ‘ â„“
      --------------------------
    â†’ Î“ [ pc ]âŠ¢ L := M â¦‚ `âŠ¤ / pc

  -- COND:
  âŠ¢if : âˆ€ {Î“ L M N s â„“ pc}
    â†’ Î“ [ pc ]âŠ¢ L â¦‚ `ğ”¹ / â„“
    â†’ Î“ [ pc âŠ” â„“ ]âŠ¢ M â¦‚ s
    â†’ Î“ [ pc âŠ” â„“ ]âŠ¢ N â¦‚ s
      ---------------------
    â†’ Î“ [ pc ]âŠ¢ if L M N â¦‚ s

  -- SUB:
  âŠ¢sub : âˆ€ {Î“ M s sâ€² pc}
    â†’ Î“ [ pc ]âŠ¢ M â¦‚ s
    â†’ s <:â‚› sâ€²
      ---------------
    â†’ Î“ [ pc ]âŠ¢ M â¦‚ sâ€²
