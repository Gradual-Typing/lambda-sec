module BigStep where

open import Data.Empty using (âŠ¥; âŠ¥-elim)
open import Data.Unit using (âŠ¤; tt)
open import Data.Product using (Î£; âˆƒ; Î£-syntax; âˆƒ-syntax; _Ã—_; projâ‚; projâ‚‚) renaming (_,_ to âŸ¨_,_âŸ©)
open import Relation.Nullary using (Dec; yes; no; Â¬_)
import Relation.Binary.PropositionalEquality as Eq
open Eq using (_â‰¡_; refl; sym; cong; congâ‚‚)
open import Statics


Rename : Context â†’ Context â†’ Set
Rename Î“ Î” = âˆ€ {X} â†’ Î“ âˆ‹ X â†’ Î” âˆ‹ X

Subst : Context â†’ Context â†’ Set
Subst Î“ Î” = âˆ€ {X} â†’ Î“ âˆ‹ X â†’ Î” âŠ¢â‚‘ X

-- we first define substitution
-- extension lemma
ext : âˆ€ {Î“ Î” A}
  â†’ Rename Î“ Î”
    ---------------------------------
  â†’ Rename (Î“ , A) (Î” , A)
ext Ï Z      =  Z
ext Ï (S x)  =  S (Ï x)

-- renaming
renameáµ¥ : âˆ€ {Î“ Î”}
  â†’ Rename Î“ Î”
    -----------------------
  â†’ (âˆ€ {A} â†’ Î“ âŠ¢áµ¥ A â†’ Î” âŠ¢áµ¥ A)
renameâ‚‘ : âˆ€ {Î“ Î”}
  â†’ Rename Î“ Î”
    -----------------------
  â†’ (âˆ€ {A} â†’ Î“ âŠ¢â‚‘ A â†’ Î” âŠ¢â‚‘ A)
renameáµ¥ Ï (Æ› N / ğ“)            = Æ› (renameâ‚‘ (ext Ï) N) / ğ“
renameáµ¥ Ï (`true/ ğ“)           = `true/ ğ“
renameáµ¥ Ï (`false/ ğ“)          = `false/ ğ“
renameâ‚‘ Ï (` x)                =  ` (Ï x)
renameâ‚‘ Ï (val v)              =  val (renameáµ¥ Ï v)
renameâ‚‘ Ï (L Â· M)              =  (renameâ‚‘ Ï L) Â· (renameâ‚‘ Ï M)
renameâ‚‘ Ï (if L M N)           =  if (renameâ‚‘ Ï L) (renameâ‚‘ Ï M) (renameâ‚‘ Ï N)
renameâ‚‘ Ï (M `âˆ§ N)             =  (renameâ‚‘ Ï M) `âˆ§ (renameâ‚‘ Ï N)
renameâ‚‘ Ï (M `âˆ¨ N)             =  (renameâ‚‘ Ï M) `âˆ¨ (renameâ‚‘ Ï N)
renameâ‚‘ Ï (sub M âŠ¢â‰¤)           =  sub (renameâ‚‘ Ï M) âŠ¢â‰¤

-- extension (in terms of well-formedness)
exts : âˆ€ {Î“ Î” A}
  â†’ Subst Î“ Î”
    ---------------------------------
  â†’ Subst (Î“ , A) (Î” , A)
exts Ïƒ Z      =  ` Z
exts Ïƒ (S x)  =  renameâ‚‘ S_ (Ïƒ x)

-- substitution
substáµ¥ : âˆ€ {Î“ Î”}
  â†’ Subst Î“ Î”
    -----------------------
  â†’ (âˆ€ {A} â†’ Î“ âŠ¢áµ¥ A â†’ Î” âŠ¢áµ¥ A)
substâ‚‘ : âˆ€ {Î“ Î”}
  â†’ Subst Î“ Î”
    -----------------------
  â†’ (âˆ€ {A} â†’ Î“ âŠ¢â‚‘ A â†’ Î” âŠ¢â‚‘ A)
substáµ¥ Ïƒ (Æ› N / ğ“)          = Æ› (substâ‚‘ (exts Ïƒ) N) / ğ“
substáµ¥ Ïƒ (`true/ ğ“)         = `true/ ğ“
substáµ¥ Ïƒ (`false/ ğ“)        = `false/ ğ“
substâ‚‘ Ïƒ (` k)              =  Ïƒ k
substâ‚‘ Ïƒ (val v)            =  val (substáµ¥ Ïƒ v)
substâ‚‘ Ïƒ (L Â· M)            =  (substâ‚‘ Ïƒ L) Â· (substâ‚‘ Ïƒ M)
substâ‚‘ Ïƒ (if L M N)         =  if (substâ‚‘ Ïƒ L) (substâ‚‘ Ïƒ M) (substâ‚‘ Ïƒ N)
substâ‚‘ Ïƒ (M `âˆ§ N)           =  (substâ‚‘ Ïƒ M) `âˆ§ (substâ‚‘ Ïƒ N)
substâ‚‘ Ïƒ (M `âˆ¨ N)           =  (substâ‚‘ Ïƒ M) `âˆ¨ (substâ‚‘ Ïƒ N)
substâ‚‘ Ïƒ (sub M âŠ¢â‰¤)         =  sub (substâ‚‘ Ïƒ M) âŠ¢â‰¤

_â€¢_ : âˆ€ {Î“ Î” A}
  â†’ Subst Î“ Î”
  â†’ Î” âŠ¢â‚‘ A
  â†’ Subst (Î“ , A) Î”
_â€¢_ Ïƒ M Z = M
_â€¢_ Ïƒ M (S x) = Ïƒ x

Ïƒâ‚€ : âˆ€ {Î“ A} â†’ Î“ âŠ¢â‚‘ A â†’ Subst (Î“ , A) Î“
Ïƒâ‚€ M Z      =  M
Ïƒâ‚€ M (S x)  =  ` x

_[_] : âˆ€ {Î“ A B}
  â†’ Î“ , A âŠ¢â‚‘ B
  â†’ Î“ âŠ¢â‚‘ A
    ---------
  â†’ Î“ âŠ¢â‚‘ B
_[_] {Î“} {A} {B} N M =  substâ‚‘ {Î“ , A} {Î“} (Ïƒâ‚€ M) N

subst-dist-âˆ§ : âˆ€ {Î“ Î” ğ“â‚ ğ“â‚‚}
  â†’ (Ïƒ : Subst Î“ Î”)
  â†’ (M : Î“ âŠ¢â‚‘ `ğ”¹ / ğ“â‚)
  â†’ (N : Î“ âŠ¢â‚‘ `ğ”¹ / ğ“â‚‚)
  â†’ substâ‚‘ Ïƒ (M `âˆ§ N) â‰¡ (substâ‚‘ Ïƒ M) `âˆ§ (substâ‚‘ Ïƒ N)
subst-dist-âˆ§ Ïƒ M N = refl

subst-dist-Â· : âˆ€ {Î“ Î” tâ‚ tâ‚‚ ğ“â‚ ğ“â‚‚ ğ“}
  â†’ (Ïƒ : Subst Î“ Î”)
  â†’ (M : Î“ âŠ¢â‚‘ ((tâ‚ / ğ“â‚) â‡’ (tâ‚‚ / ğ“â‚‚)) / ğ“)
  â†’ (N : Î“ âŠ¢â‚‘ (tâ‚ / ğ“â‚))
  â†’ substâ‚‘ Ïƒ (M Â· N) â‰¡ (substâ‚‘ Ïƒ M) Â· (substâ‚‘ Ïƒ N)
subst-dist-Â· Ïƒ M N = refl

rename-ext : âˆ€ {Î“ A B}
  â†’ (M : Î“ âŠ¢â‚‘ B)
  â†’ (N : Î“ âŠ¢â‚‘ A)
  â†’ (renameâ‚‘ S_ M) [ N ] â‰¡ M
rename-ext {Î“} {A} {B} (` x) N = refl
rename-ext {Î“} {A} {B} (val x) N = {!!}
rename-ext (Mâ‚ `âˆ§ Mâ‚‚) N rewrite subst-dist-âˆ§ (Ïƒâ‚€ N) (renameâ‚‘ S_ Mâ‚) (renameâ‚‘ S_ Mâ‚‚) | rename-ext Mâ‚ N | rename-ext Mâ‚‚ N = refl
rename-ext (Mâ‚ `âˆ¨ Mâ‚‚) N = {!!}
rename-ext (Mâ‚ Â· Mâ‚‚) N rewrite subst-dist-Â· (Ïƒâ‚€ N) (renameâ‚‘ S_ Mâ‚) (renameâ‚‘ S_ Mâ‚‚) | rename-ext Mâ‚ N | rename-ext Mâ‚‚ N = refl
rename-ext {Î“} {A} {.(_ / (_ âŠ” _))} (if M Mâ‚ Mâ‚‚) N = {!!}
rename-ext {Î“} {A} {B} (sub M x) N = {!!}


postulate
  subst-ext : âˆ€ {Î“ Î” A Aâ€²}
    â†’ (Ïƒ : Subst Î“ Î”)
    â†’ (M : Î“ , Aâ€² âŠ¢â‚‘ A)
    â†’ (N : Î” âŠ¢â‚‘ Aâ€²)
    â†’ (substâ‚‘ (exts Ïƒ) M) [ N ] â‰¡ substâ‚‘ (Ïƒ â€¢ N) M
-- subst-ext Ïƒ (` Z) N = refl
-- subst-ext Ïƒ (` (S x)) N = {!!}
-- subst-ext Ïƒ (val x) N = {!!}
-- subst-ext Ïƒ (M `âˆ§ Mâ‚) N = {!!}
-- subst-ext Ïƒ (M `âˆ¨ Mâ‚) N = {!!}
-- subst-ext Ïƒ (M Â· Mâ‚) N = {!!}
-- subst-ext Ïƒ (if M Mâ‚ Mâ‚‚) N = {!!}
-- subst-ext Ïƒ (sub M x) N = {!!}

_âŸ¦âˆ§âŸ§_ : âˆ€ {ğ“â‚˜ ğ“â‚™}
      â†’ (M : âˆ… âŠ¢áµ¥ `ğ”¹ / ğ“â‚˜)
      â†’ (N : âˆ… âŠ¢áµ¥ `ğ”¹ / ğ“â‚™)
        -----------------------
      â†’ âˆ… âŠ¢áµ¥ `ğ”¹ / (ğ“â‚˜ âŠ” ğ“â‚™)
_âŸ¦âˆ§âŸ§_ {ğ“â‚˜} {ğ“â‚™} (`true/ ğ“â‚˜)  (`true/ ğ“â‚™)   = `true/  (ğ“â‚˜ âŠ” ğ“â‚™)
_âŸ¦âˆ§âŸ§_ {ğ“â‚˜} {ğ“â‚™} (`true/ ğ“â‚˜)  (`false/ ğ“â‚™)  = `false/ (ğ“â‚˜ âŠ” ğ“â‚™)
_âŸ¦âˆ§âŸ§_ {ğ“â‚˜} {ğ“â‚™} (`false/ ğ“â‚˜) (`true/ ğ“â‚™)   = `false/ (ğ“â‚˜ âŠ” ğ“â‚™)
_âŸ¦âˆ§âŸ§_ {ğ“â‚˜} {ğ“â‚™} (`false/ ğ“â‚˜) (`false/ ğ“â‚™)  = `false/ (ğ“â‚˜ âŠ” ğ“â‚™)

_âŸ¦âˆ¨âŸ§_ : âˆ€ {ğ“â‚˜ ğ“â‚™}
      â†’ (M : âˆ… âŠ¢áµ¥ `ğ”¹ / ğ“â‚˜)
      â†’ (N : âˆ… âŠ¢áµ¥ `ğ”¹ / ğ“â‚™)
        -----------------------
      â†’ âˆ… âŠ¢áµ¥ `ğ”¹ / (ğ“â‚˜ âŠ” ğ“â‚™)
_âŸ¦âˆ¨âŸ§_ {ğ“â‚˜} {ğ“â‚™} (`true/ ğ“â‚˜)  (`true/ ğ“â‚™)   = `true/  (ğ“â‚˜ âŠ” ğ“â‚™)
_âŸ¦âˆ¨âŸ§_ {ğ“â‚˜} {ğ“â‚™} (`true/ ğ“â‚˜)  (`false/ ğ“â‚™)  = `true/  (ğ“â‚˜ âŠ” ğ“â‚™)
_âŸ¦âˆ¨âŸ§_ {ğ“â‚˜} {ğ“â‚™} (`false/ ğ“â‚˜) (`true/ ğ“â‚™)   = `true/  (ğ“â‚˜ âŠ” ğ“â‚™)
_âŸ¦âˆ¨âŸ§_ {ğ“â‚˜} {ğ“â‚™} (`false/ ğ“â‚˜) (`false/ ğ“â‚™)  = `false/ (ğ“â‚˜ âŠ” ğ“â‚™)


data _â‡“_ : âˆ€ {A} â†’ âˆ… âŠ¢â‚‘ A â†’ âˆ… âŠ¢áµ¥ A â†’ Set where -- only run on closed terms

  -- v â‡“ v
  â‡“-val : âˆ€ {A} {v : âˆ… âŠ¢áµ¥ A}
        --------------
        â†’ (val v) â‡“ v  -- simply get rid of the `val`

  -- binops
  â‡“-âˆ§ : âˆ€ {ğ“â‚˜ ğ“â‚™ Vâ‚˜ Vâ‚™} {M : âˆ… âŠ¢â‚‘ `ğ”¹ / ğ“â‚˜} {N : âˆ… âŠ¢â‚‘ `ğ”¹ / ğ“â‚™}
      â†’ M â‡“ Vâ‚˜
      â†’ N â‡“ Vâ‚™
        ------------------------
      â†’ (M `âˆ§ N) â‡“ (Vâ‚˜ âŸ¦âˆ§âŸ§ Vâ‚™)

  â‡“-âˆ¨ : âˆ€ {ğ“â‚˜ ğ“â‚™ Vâ‚˜ Vâ‚™} {M : âˆ… âŠ¢â‚‘ `ğ”¹ / ğ“â‚˜} {N : âˆ… âŠ¢â‚‘ `ğ”¹ / ğ“â‚™}
      â†’ M â‡“ Vâ‚˜
      â†’ N â‡“ Vâ‚™
        ------------------------
      â†’ (M `âˆ¨ N) â‡“ (Vâ‚˜ âŸ¦âˆ¨âŸ§ Vâ‚™)

  â‡“-condâ‚ : âˆ€ {t ğ“â‚— ğ“ Vâ‚˜} {L : âˆ… âŠ¢â‚‘ `ğ”¹ / ğ“â‚—} {M : âˆ… âŠ¢â‚‘ t / (ğ“ âŠ” ğ“â‚—)} {N : âˆ… âŠ¢â‚‘ t / (ğ“ âŠ” ğ“â‚—)}
      â†’ L â‡“ (`true/ ğ“â‚—)
      â†’ M â‡“ Vâ‚˜
        ------------------------
      â†’ if L M N â‡“ Vâ‚˜  -- note that `Vâ‚˜` already inhebits type `A âŠ”â‚› ğ“â‚—`

  â‡“-condâ‚‚ : âˆ€ {t ğ“â‚— ğ“ Vâ‚™} {L : âˆ… âŠ¢â‚‘ `ğ”¹ / ğ“â‚—} {M : âˆ… âŠ¢â‚‘ t / (ğ“ âŠ” ğ“â‚—)} {N : âˆ… âŠ¢â‚‘ t / (ğ“ âŠ” ğ“â‚—)}
      â†’ L â‡“ (`false/ ğ“â‚—)
      â†’ N â‡“ Vâ‚™
        ------------------------
      â†’ if L M N â‡“ Vâ‚™  -- note that `Vâ‚™` already inhebits type `A âŠ”â‚› ğ“â‚—`

  â‡“-app : âˆ€ {tâ‚ tâ‚‚ ğ“â‚ ğ“â‚‚ ğ“ Vâ‚™ V Mâ€²} {M : âˆ… âŠ¢â‚‘ ((tâ‚ / ğ“â‚) â‡’ (tâ‚‚ / ğ“â‚‚)) / ğ“} {N : âˆ… âŠ¢â‚‘ tâ‚ / ğ“â‚}
      â†’ M â‡“ (Æ› Mâ€² / ğ“)
      â†’ N â‡“ Vâ‚™
      â†’ (Mâ€² [ (val Vâ‚™) ]) â‡“ V
        ------------------------
      â†’ (M Â· N) â‡“ (V âŠ”áµ¥ ğ“)



_/_â¦‚_â‰ˆáµ¥â¦…_â¦†_ : (t : ğ•‹) â†’ (ğ“ : â„’) â†’ (vâ‚ : âˆ… âŠ¢áµ¥ (t / ğ“)) â†’ (Î¶ : â„’) â†’ (vâ‚‚ : âˆ… âŠ¢áµ¥ (t / ğ“)) â†’ Set
_/_â¦‚_â‰ˆâ‚‘â¦…_â¦†_ : (t : ğ•‹) â†’ (ğ“ : â„’) â†’ (eâ‚ : âˆ… âŠ¢â‚‘ (t / ğ“)) â†’ (Î¶ : â„’) â†’ (eâ‚‚ : âˆ… âŠ¢â‚‘ (t / ğ“)) â†’ Set

`ğ”¹ / ğ“ â¦‚ vâ‚ â‰ˆáµ¥â¦… Î¶ â¦† vâ‚‚ = ğ“ âŠ‘ Î¶ â†’ vâ‚ â‰¡ vâ‚‚
((tâ‚ / ğ“â‚) â‡’ (tâ‚‚ / ğ“â‚‚)) / ğ“ â¦‚ vâ‚ â‰ˆáµ¥â¦… Î¶ â¦† vâ‚‚ =
    ğ“ âŠ‘ Î¶
  â†’ (âˆ€ {vâ‚â€² vâ‚‚â€²}
       â†’ tâ‚ / ğ“â‚ â¦‚ vâ‚â€² â‰ˆáµ¥â¦… Î¶ â¦† vâ‚‚â€²
       â†’ tâ‚‚ / ğ“â‚‚ âŠ” ğ“ â¦‚ ((val vâ‚) Â· (val vâ‚â€²)) â‰ˆâ‚‘â¦… Î¶ â¦† ((val vâ‚‚) Â· (val vâ‚‚â€²)))

t / ğ“ â¦‚ eâ‚ â‰ˆâ‚‘â¦… Î¶ â¦† eâ‚‚ =
  (âˆ€ {vâ‚ vâ‚‚}
    â†’ eâ‚ â‡“ vâ‚
    â†’ eâ‚‚ â‡“ vâ‚‚
    â†’ t / ğ“ â¦‚ vâ‚ â‰ˆáµ¥â¦… Î¶ â¦† vâ‚‚)

-- data _â¦‚_â‰ˆáµ¥â¦…_â¦†_ : (s : ğ•Š) â†’ (vâ‚ : âˆ… âŠ¢áµ¥ s) â†’ (Î¶ : â„’) â†’ (vâ‚‚ : âˆ… âŠ¢áµ¥ s) â†’ Set
-- data _â¦‚_â‰ˆâ‚‘â¦…_â¦†_ : (s : ğ•Š) â†’ (eâ‚ : âˆ… âŠ¢â‚‘ s) â†’ (Î¶ : â„’) â†’ (eâ‚‚ : âˆ… âŠ¢â‚‘ s) â†’ Set

-- data _â¦‚_â‰ˆáµ¥â¦…_â¦†_ where
--   â‰ˆáµ¥-`ğ”¹ : âˆ€ {ğ“ Î¶}
--         â†’ (vâ‚ vâ‚‚ : âˆ… âŠ¢áµ¥ `ğ”¹ / ğ“)
--         â†’ ğ“ âŠ‘ Î¶
--         â†’ vâ‚ â‰¡ vâ‚‚
--         â†’ (`ğ”¹ / ğ“) â¦‚ vâ‚ â‰ˆáµ¥â¦… Î¶ â¦† vâ‚‚

--   â‰ˆáµ¥-â‡’ : âˆ€ {sâ‚ sâ‚‚ ğ“ Î¶}
--        â†’ (vâ‚ vâ‚‚ : âˆ… âŠ¢áµ¥ (sâ‚ â‡’ sâ‚‚) / ğ“)
--        â†’ ğ“ âŠ‘ Î¶
--        â†’ (âˆ€ {vâ‚â€² vâ‚‚â€² : âˆ… âŠ¢áµ¥ sâ‚}
--             â†’ sâ‚ â¦‚ vâ‚â€² â‰ˆáµ¥â¦… Î¶ â¦† vâ‚‚â€²
--             â†’ (sâ‚‚ âŠ”â‚› ğ“) â¦‚ ((val vâ‚) Â· (val vâ‚â€²)) â‰ˆâ‚‘â¦… Î¶ â¦† ((val vâ‚‚) Â· (val vâ‚‚â€²)))
--        â†’ ((sâ‚ â‡’ sâ‚‚) / ğ“) â¦‚ vâ‚ â‰ˆáµ¥â¦… Î¶ â¦† vâ‚‚

-- {-# NO_POSITIVITY_CHECK #-}
-- data _â¦‚_â‰ˆâ‚‘â¦…_â¦†_ where
--   â‰ˆâ‚‘-e : âˆ€ {s Î¶}
--        â†’ (eâ‚ eâ‚‚ : âˆ… âŠ¢â‚‘ s)
--        â†’ (vâ‚ vâ‚‚ : âˆ… âŠ¢áµ¥ s)
--        â†’ eâ‚ â‡“ vâ‚
--        â†’ eâ‚‚ â‡“ vâ‚‚
--        â†’ s â¦‚ vâ‚ â‰ˆáµ¥â¦… Î¶ â¦† vâ‚‚
--        â†’ s â¦‚ eâ‚ â‰ˆâ‚‘â¦… Î¶ â¦† eâ‚‚


-- fundamental property
-- first we define related substitutions under a typing context Î“
_âŠ¢_â‰ˆâ‚›â¦…_â¦†_ : âˆ€ Î“ â†’ (âˆ€ {A} â†’ Î“ âˆ‹ A â†’ âˆ… âŠ¢â‚‘ A) â†’ â„’ â†’ (âˆ€ {A} â†’ Î“ âˆ‹ A â†’ âˆ… âŠ¢â‚‘ A) â†’ Set
Î“ âŠ¢ Ïƒâ‚ â‰ˆâ‚›â¦… Î¶ â¦† Ïƒâ‚‚ = âˆ€ {t ğ“} {x : Î“ âˆ‹ (t / ğ“)} â†’ t / ğ“ â¦‚ (Ïƒâ‚ x) â‰ˆâ‚‘â¦… Î¶ â¦† (Ïƒâ‚‚ x)

â‡“â‰¡ : âˆ€ {s v vâ‚ vâ‚‚} â†’ (_â‡“_ {s} (val v) vâ‚) â†’ (_â‡“_ {s} (val v) vâ‚‚) â†’ vâ‚ â‰¡ vâ‚‚
â‡“â‰¡ â‡“-val â‡“-val = refl



-- If Î“ âŠ¢ e : s and Î“ âŠ¢ Ïƒâ‚ â‰ˆÎ¶ Ïƒâ‚‚ then Ïƒâ‚(e) â‰ˆÎ¶ Ïƒâ‚‚(e) : s
fundamental : âˆ€ {Î“ t ğ“ Î¶}
  â†’ (Ïƒâ‚ : (âˆ€ {A} â†’ Î“ âˆ‹ A â†’ âˆ… âŠ¢â‚‘ A))
  â†’ (Ïƒâ‚‚ : (âˆ€ {A} â†’ Î“ âˆ‹ A â†’ âˆ… âŠ¢â‚‘ A))
  â†’ (e : Î“ âŠ¢â‚‘ (t / ğ“))
  â†’ Î“ âŠ¢ Ïƒâ‚ â‰ˆâ‚›â¦… Î¶ â¦† Ïƒâ‚‚
    -----------------------------------------------
  â†’ t / ğ“ â¦‚ (substâ‚‘ Ïƒâ‚ e) â‰ˆâ‚‘â¦… Î¶ â¦† (substâ‚‘ Ïƒâ‚‚ e)

fundamental-lemma : âˆ€ {Î“ Î¶ tâ‚ tâ‚‚ ğ“â‚ ğ“â‚‚ ğ“ N}
  â†’ (Ïƒâ‚ Ïƒâ‚‚ : (âˆ€ {A} â†’ Î“ âˆ‹ A â†’ âˆ… âŠ¢â‚‘ A))
  â†’ Î“ âŠ¢ Ïƒâ‚ â‰ˆâ‚›â¦… Î¶ â¦† Ïƒâ‚‚
  â†’ ((tâ‚ / ğ“â‚) â‡’ (tâ‚‚ / ğ“â‚‚)) / ğ“ â¦‚ (Æ› (substâ‚‘ (exts Ïƒâ‚) N) / ğ“) â‰ˆáµ¥â¦… Î¶ â¦† (Æ› (substâ‚‘ (exts Ïƒâ‚‚) N) / ğ“)

fundamental-lemma {N = N} Ïƒâ‚ Ïƒâ‚‚ Ïƒâ‚â‰ˆÏƒâ‚‚ = Î» ğ“âŠ‘Î¶ {vâ‚â€²} {vâ‚‚â€²} vâ‚â€²â‰ˆvâ‚‚â€² â†’
  Î» {(â‡“-app {V = vâ‚â€³} â‡“-val â‡“-val â‡“vâ‚â€³) (â‡“-app {V = vâ‚‚â€³} â‡“-val â‡“-val â‡“vâ‚‚â€³) â†’ let p = fundamental (Ïƒâ‚ â€¢ (val vâ‚â€²)) (Ïƒâ‚‚ â€¢ (val vâ‚‚â€²)) {!!} {!!} {!!} {!!} in  {!!}}

fundamental Ïƒâ‚ Ïƒâ‚‚ (` x) Ïƒâ‚â‰ˆÏƒâ‚‚ = Ïƒâ‚â‰ˆÏƒâ‚‚
fundamental Ïƒâ‚ Ïƒâ‚‚ (val (Æ› N / ğ“)) Ïƒâ‚â‰ˆÏƒâ‚‚ = Î» {â‡“-val â‡“-val â†’ {!!} }



-- record _â‡”_ (A B : Set) : Set where
--   field
--     to   : A â†’ B
--     from : B â†’ A

-- -- properties
-- -- non-interference of Î»-sec
-- -- non-interference : âˆ€ {t V}
-- --   â†’ (M : âˆ… , (t / ğ») âŠ¢â‚‘ `ğ”¹ / ğ¿)
-- --   â†’ (Vâ‚ : âˆ… âŠ¢áµ¥ (t / ğ»))
-- --   â†’ (Vâ‚‚ : âˆ… âŠ¢áµ¥ (t / ğ»))
-- --     -----------------------------------------------
-- --   â†’ ((M [ (val Vâ‚) ]) â‡“ V) â‡” ((M [ (val Vâ‚‚) ]) â‡“ V)
-- -- non-interference {t} {V} M Vâ‚ Vâ‚‚ = record { to = {!!} ; from = {!!} }
